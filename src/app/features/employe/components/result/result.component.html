<h3 class="text-2xl font-bold text-center text-gray-800 mb-6">
  Votre Fiche de Paie
</h3>

<div *ngIf="result() as r; else noResult">
  <div
    #fichePaie
    class="max-w-4xl mx-auto space-y-6 p-4 bg-white rounded-lg shadow"
  >
    <!-- En-tête -->
    <div
      class="flex justify-between items-center mb-4 border-b border-gray-300 pb-2"
    >
      <h2 class="text-2xl font-bold text-gray-800">Bulletin de Salaire</h2>
      <span class="text-gray-500">Mois : Décembre 2025</span>
    </div>

    <!-- Infos employé -->
    <div
      class="grid grid-cols-2 gap-4 text-gray-700 bg-gray-50 p-4 rounded-lg shadow-sm"
    >
      <div><span class="font-semibold">Nom :</span> {{ r.nom }}</div>
      <div><span class="font-semibold">Poste :</span> {{ r.poste }}</div>
      <div>
        <span class="font-semibold">Jours ouvrables :</span>
        {{ r.joursOuvrablesParMois ?? 22 }}
      </div>
      <div>
        <span class="font-semibold">Congés pris :</span>
        {{ r.congesPris ?? 0 }} jours
      </div>
    </div>

    <!-- Revenus -->
    <div class="rounded-lg shadow-sm overflow-hidden">
      <h3 class="bg-blue-100 text-blue-800 text-lg font-semibold px-4 py-2">
        Revenus
      </h3>
      <table class="w-full table-auto border-b border-gray-300">
        <tbody class="text-gray-700">
          <tr class="border-b border-gray-200">
            <td class="px-4 py-2">Salaire de base</td>
            <td class="px-4 py-2 text-right">{{ r.salaireBase | number }}</td>
          </tr>
          <tr class="border-b border-gray-200">
            <td class="px-4 py-2">Prime</td>
            <td class="px-4 py-2 text-right">{{ r.prime | number }}</td>
          </tr>
          <tr class="border-b border-gray-200">
            <td class="px-4 py-2">Salaire Heures sup</td>
            <td class="px-4 py-2 text-right">
              {{ r.salaireheureSup | number }}
            </td>
          </tr>
          <tr class="border-b border-gray-200">
            <td class="px-4 py-2">Heures sup</td>
            <td class="px-4 py-2 text-right">{{ r.heureSup | number }}</td>
          </tr>
          <tr class="border-b border-gray-200">
            <td class="px-4 py-2">Congés payés</td>
            <td class="px-4 py-2 text-right">
              {{
                (r.congesPris ?? 0) *
                  ((r.salaireBase ?? 0) / (r.joursOuvrablesParMois ?? 22))
                  | number : "1.2-2"
              }}
            </td>
          </tr>
          <tr class="font-bold bg-gray-100">
            <td class="px-4 py-2">Salaire brut</td>
            <td class="px-4 py-2 text-right">{{ r.brut | number }}</td>
          </tr>
        </tbody>
      </table>
    </div>

    <!-- Autres avantages -->
    <div
      *ngIf="r.autresAvantages?.length"
      class="rounded-lg shadow-sm overflow-hidden"
    >
      <h3 class="bg-yellow-100 text-yellow-800 text-lg font-semibold px-4 py-2">
        Autres avantages
      </h3>
      <table class="w-full table-auto">
        <tbody>
          <tr
            *ngFor="let a of r.autresAvantages"
            class="border-b border-gray-200"
          >
            <td class="px-4 py-2">{{ a.nom }}</td>
            <td class="px-4 py-2 text-right">{{ a.montant | number }}</td>
          </tr>
        </tbody>
      </table>
    </div>

    <!-- Retenues -->
    <div class="rounded-lg shadow-sm overflow-hidden">
      <h3 class="bg-red-100 text-red-800 text-lg font-semibold px-4 py-2">
        Retenues
      </h3>
      <table class="w-full table-auto">
        <tbody class="text-gray-700">
          <tr class="border-b border-gray-200">
            <td class="px-4 py-2">CNAPS (1%)</td>
            <td class="px-4 py-2 text-right text-red-600">
              - {{ r.cnaps | number }}
            </td>
          </tr>
          <tr class="border-b border-gray-200">
            <td class="px-4 py-2">OSTIE (1%)</td>
            <td class="px-4 py-2 text-right text-red-600">
              - {{ r.ostie | number }}
            </td>
          </tr>
          <tr class="border-b border-gray-200">
            <td class="px-4 py-2">IRSA</td>
            <td class="px-4 py-2 text-right text-red-600">
              - {{ r.irsa | number }}
            </td>
          </tr>
        </tbody>
      </table>
    </div>

    <!-- Net à payer -->
    <div
      class="flex justify-between items-center bg-green-100 p-4 rounded-lg font-bold text-lg"
    >
      <span>Net à payer</span>
      <span class="text-green-700 text-xl">{{ r.net | number }} Ar</span>
    </div>
  </div>

  <!-- Bouton téléchargement -->
  <div class="text-right mt-4">
    <button
      (click)="downloadPdf()"
      class="bg-blue-600 text-white px-4 py-2 rounded-lg hover:bg-blue-700 transition"
    >
      ⬇️ Télécharger la fiche
    </button>
  </div>
</div>

<ng-template #noResult>
  <div class="text-center text-gray-500 italic py-10">
    La fiche de paie n’est pas encore générée. Veuillez remplir le formulaire et
    cliquer sur « Calculer la fiche de paie ».
  </div>
</ng-template>
